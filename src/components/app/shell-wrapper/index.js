// import React from "react";

// function ShellWrapper(props) {
//   const { children } = props;
//   return <div>{children}</div>;
// }

// export default ShellWrapper;

/* eslint-disable no-undef */
import React, { Component, Fragment } from "react";
import { Routes, Route, withRouter } from "react-router-dom";
import PropTypes from "prop-types";
import i18n from "i18n-js";
import { AppShellSide, ShellProvider } from "@target-energysolutions/app-shell";
import { SVGIcon } from "react-md";
import withOAuth, {
  cleanUp,
  OauthHelper,
} from "@target-energysolutions/hoc-oauth";
//import "@target-energysolutions/gis-map/styles.css";
import "./style.scss";

class App extends Component {
  signOut = () => {
    cleanUp();
    localStorage.setItem("isLoggedIn", false);
    OauthHelper.redirectToSSO();
  };

  handleNavModChange = ({ subModule }) => {
    this.setState({
      activeNavSubModule: subModule,
    });
    this.handleNavigateJump(subModule);
  };
  handleNavigateJump = (value) => {
    const { history } = this.props;
    history.push(`/${value}`);
  };
  handleNotificationItemClick = (item) => {
    const { data: itemData } = item;
    let { action, url, moduleName } = itemData || {};
    if (moduleName === "meeting" && action === "popup") {
      const id = url.split("/").pop();
      // eslint-disable-next-line no-undef
      // location.href = `${PRODUCT_APP_URL_WORKSPACE}/meeting/${id}`;
      return;
    }
    if (moduleName === "message") {
      const { workspaceId } = itemData;
      // eslint-disable-next-line no-undef
      //location.href = `${PRODUCT_APP_URL_WORKSPACE}/workspace/details/${workspaceId}`;
      return;
    }
    if (url) {
      //   if (validURL(url)) {
      //    // location.href = url;
      //   } else {
      //     url = url[0] === "/" ? url : `/${url}`;
      //     this.props.history.push(url);
      //   }
    }
  };
  onLogOut = (params) => {
    console.log("onLogOut", { params });
  };

  // handleChangeLang = lang => {
  //   i18n.changeLanguage(lang)
  //   // this.setState({ lang })
  // }
  handleChangeLang = (lang) => {
    changeLang(lang);
    const url = new URL(window.location.href);
    if (url.hostname !== "localhost") {
      const domainParts = url.hostname.split(".");
      domainParts.shift();
      const options = {
        domain: `.${domainParts.join(".")}`,
      };
      localStorage.setItem("language", lang, options);
    } else {
      localStorage.setItem("language", lang);
    }
    //location.reload();
  };

  render() {
    const { ssoCallback, showToast } = this.props;
    const productConfig = {
      workspace: PRODUCT_APP_URL_WORKSPACE,
      configurator: PRODUCT_URL_CONFIGURATOR,
      profile: PRODUCT_APP_URL_PROFILE,
      meeting: PRODUCT_APP_URL_FLUXBLE_MEETING,
      edge: PRODUCT_APP_URL_LOAD,
      okr: PRODUCT_APP_URL_WORKSPACE,
      planner: PRODUCT_APP_URL_PLANNER,
      hcm: PRODUCT_APP_URL_HCM,
      media: MEETING_URL,
      taskManagement: PRODUCT_APP_URL_WORKSPACE,
      crm: PRODUCT_APP_URL_CRM,
      sso: OAUTH_HOST,
      peopleSearch: PRODUCT_APP_URL_WORKSPACE,
      amc: PRODUCT_APP_URL_AMC,
      map: PRODUCT_APP_URL_MAP,
      pulse: PRODUCT_APP_URL_PULSE,
      reach: PRODUCT_APP_URL_REACH,
      organisation: PRODUCT_APP_URL_ORGANIZATION,
      pdo: PRODUCT_APP_URL_PDO,
      csr: PRODUCT_APP_URL_CSR,
      was: PRODUCT_APP_URL_CONSUME,
      bi: PRODUCT_APP_URL_BI,
      peopleanalytics: PRODUCT_APP_URL_PEOPLEANALYTICS,
      meetings: "",
      accessToken: getAccessToken(),
    };

    return (
      <Fragment>
        <ShellProvider>
          <AppShellSide
            envURL={PRODUCT_APP_URL_WORKSPACE}
            apps={[]}
            disableSidebar={false}
            accessToken={getAccessToken()}
            notificationAPI={PRODUCT_APP_URL_API}
            meTo={PRODUCT_APP_URL_PROFILE}
            production={"GIS FE"}
            onLogoClick={() => {
              window.open(PRODUCT_APP_URL_WORKSPACE, "_self");
            }}
            productConfig={productConfig}
            forcedLogoApp={"gis-fe"}
            // eslint-disable-next-line no-undef
            // folioAPI={''}
            // eslint-disable-next-line no-undef
            availableApps={[
              {
                key: "venue",
                disabled: true,
              },
            ]}
            actionMenus={[
              {
                primaryText: i18n.t(l.signout),
                onClick: this.signOut,
              },
            ]}
            title="GIS FE"
            l={
              localStorage.getItem("language") ||
              i18n.translations[i18n.currentLocale()]
            }
            lang={localStorage.getItem("language") || i18n.currentLocale()}
            languages={[
              { key: "en", name: i18n.t(l.english), label: i18n.t(l.english) },
              { key: "tr", name: i18n.t(l.turkish), label: i18n.t(l.turkish) },
              { key: "zh", name: i18n.t(l.chinese), label: i18n.t(l.chinese) },
              { key: "fr", name: i18n.t(l.french), label: i18n.t(l.french) },
              { key: "ar", name: i18n.t(l.arabic), label: i18n.t(l.arabic) },
            ]}
            onLangChange={this.handleChangeLang}
            navBarCollapsed={false}
            extraContentCollapsed={false}
            onLogOut={this.onLogOut}
            meeraLogoUrl="/"
            onNotificationItemClick={this.handleNotificationItemClick}
            onViewNotificationAll={() =>
              this.props.history.push("/workspace/notification")
            }
            onModuleChange={(module, e) => {
              const { jumpUrl = "", displayName = "application" } = e || {
                jumpUrl: PRODUCT_APP_URL_WORKSPACE,
              };
              if (jumpUrl !== "") {
                window.open(jumpUrl, "_self");
              } else {
                message.error(
                  `The redirect URL for ${displayName} is missing from the configuration`
                );
              }
            }}
            logo={"/static/images/logo.svg"}
            routes={
              <Routes>
                {/* <Route
                  path="/sso/callback"
                  exact
                  render={() => (
                    <SSOLoginSplash
                      onFinishSSO={() => {
                        // const { history } = this.props
                        console.log("onFinishSSO");
                        // history && history.push('/')
                      }}
                      ssoCallback={ssoCallback}
                    />
                  )}
                /> */}
                {/* <Route
                  path="/*"
                /  render={(props) => <GIS showToast={showToast} {...props} />}
                /> */}
              </Routes>
            }
            modules={{
              extraApps: [
                {
                  name: "GIS Map",
                  key: "gis-map",
                  onClick: () => {
                    //  history.push("/");
                  },
                  icon: (
                    <SVGIcon
                      size="20"
                      style={{ transform: "translate(3px, 3px)" }}
                    >
                      {/* <g
                        id="Page-1"
                        stroke="none"
                        strokeWidth="1"
                        fill="none"
                        fillRule="evenodd"
                      > */}
                      <g
                        id="Page-1"
                        stroke="none"
                        strokeWidth="1"
                        fill="none"
                        fillRule="evenodd"
                      >
                        <g
                          id="gis_disable"
                          transform="translate(0.888546, 0.500000)"
                        >
                          <path
                            d="M10.4754395,5.4359812 C11.3283906,5.43740806 12.0294906,4.73807885 12.0303613,3.88500347 C12.0312303,3.02649152 11.3403511,2.33449391 10.4799441,2.33212703 C9.62164962,2.32980293 8.92626581,3.02239079 8.92536408,3.88049888 C8.92449504,4.73481691 9.62177388,5.43454998 10.4754395,5.4359812 L10.4754395,5.4359812 Z M10.881691,0 C11.0726855,0.0411625959 11.2654507,0.0754906476 11.4543637,0.124606168 C13.1689955,0.570529113 14.3797972,2.12069694 14.3512785,3.87583897 C14.3453449,4.24139388 14.2563405,4.61589584 14.1460558,4.96756421 C13.7973697,6.07948242 13.2653937,7.11274125 12.6756346,8.11108176 C11.9995118,9.25561939 11.2787781,10.3737819 10.576715,11.5029729 C10.5504642,11.5452228 10.5168817,11.582906 10.4790743,11.6327981 C10.4510526,11.5994021 10.4298345,11.5783703 10.4135248,11.5540455 C9.29036062,9.88122872 8.22563183,8.1738353 7.35981934,6.35040997 C7.07326554,5.74695078 6.7984858,5.13379896 6.67043129,4.4750421 C6.4318125,3.24758902 6.79935565,2.18040601 7.61499637,1.26299271 C8.24069889,0.559221048 9.04077549,0.162413624 9.9725724,0.030196259 C10.0070868,0.0252878136 10.0401723,0.0102828825 10.0739411,0 L10.881691,0 Z"
                            id="Fill-3"
                            fill="#556485"
                            fillRule="nonzero"
                          ></path>
                          <path
                            d="M0,11.6444852 C2.3204831,10.4413258 4.61142232,9.25348204 6.90413232,8.06473734 C7.28531349,8.72998702 7.65751655,9.37961045 8.03972291,10.046662 C7.98433203,10.0680665 7.93440879,10.0882906 7.88386423,10.1067749 C7.43909073,10.2696545 7.01078227,10.4633828 6.65519958,10.7861907 C6.36255682,11.051837 6.16593941,11.3633369 6.21940418,11.7809897 C6.25777083,12.0806223 6.42906936,12.3067215 6.64292846,12.5020341 C7.04163092,12.8661289 7.52157125,13.0869779 8.03211171,13.235039 C9.79318736,13.7457658 11.5464965,13.7330287 13.2797369,13.1088174 C13.7303819,12.946528 14.1482521,12.7156758 14.4666798,12.3410806 C14.8403119,11.9014951 14.8431078,11.3981931 14.4681399,10.9609687 C14.097894,10.5292429 13.5985063,10.3035476 13.0806342,10.1101922 C13.0288781,10.090869 12.9768734,10.0723536 12.9141509,10.04952 C13.2959534,9.38308985 13.6700204,8.73020448 14.0513569,8.06455094 C16.3477638,9.25531494 18.6385788,10.4431587 20.9554271,11.6445163 C20.8927978,11.6817956 20.852474,11.7086989 20.8096649,11.7309111 C17.4189233,13.489253 14.0276224,15.2465075 10.6386826,17.0082666 C10.5178354,17.0710512 10.4297009,17.0666087 10.3120535,17.0054085 C7.62582912,15.6086141 4.93749221,14.2158893 2.24955917,12.8223257 C1.54656416,12.4578581 0.843600221,12.0932662 0.140853743,11.7282705 C0.101244453,11.7076737 0.0639029885,11.6826655 0,11.6444852"
                            id="Fill-5"
                            fill="#AAB1C2"
                            fillRule="nonzero"
                          ></path>
                          <path
                            d="M0.0097609718,17.0866091 C0.0726698448,17.0495472 0.114298432,17.0223955 0.15816378,16.9995929 C1.24675135,16.4344383 2.33633303,15.8711786 3.42308769,15.3025135 C3.51908197,15.2522796 3.58975737,15.2607606 3.68040828,15.3078879 C5.88908445,16.4562467 8.09962458,17.6010328 10.3073998,18.7511002 C10.4309187,18.8154692 10.5243655,18.8155935 10.6477291,18.7513798 C12.8556286,17.6014988 15.0661066,16.4566195 17.2751245,15.3088509 C17.3579157,15.2658555 17.4249253,15.2456625 17.51831,15.2945295 C18.6142291,15.8680099 19.7127579,16.4365818 20.8103235,17.0068935 C20.8496843,17.027335 20.8865908,17.0525296 20.9441563,17.0872615 C20.8787311,17.1247272 20.8323183,17.1535566 20.7839795,17.1786269 C18.3489556,18.4414643 15.9137765,19.7038978 13.4786594,20.9665177 C12.5230037,21.4620533 11.5670995,21.9570917 10.6127176,22.4550504 C10.5239306,22.50137 10.4540008,22.5134236 10.3564843,22.4627548 C6.96269815,20.6992249 3.56695485,18.939423 0.171646472,17.1788133 C0.123028009,17.1535876 0.0763356458,17.1246651 0.0097609718,17.0866091"
                            id="Fill-7"
                            fill="#556485"
                          ></path>
                        </g>
                      </g>
                      {/* </g> */}
                    </SVGIcon>
                  ),
                },
                {
                  name: "Studio",
                  key: "studio",
                  onClick: () => {
                    window.open(PRODUCT_APP_URL_STUDIO, "_self");
                  },
                  icon: (
                    <SVGIcon
                      size="20"
                      style={{ transform: "translate(3px, 3px)" }}
                    >
                      {/* <g
                        id="Page-1"
                        stroke="none"
                        strokeWidth="1"
                        fill="none"
                        fillRule="evenodd"
                      > */}
                      <path
                        d="M14.4557186,8.31648282 C15.4243291,8.31648282 16.2095431,9.10169676 16.2095431,10.0703072 L16.2095431,10.0703072 L16.2095431,10.3702112 C16.8190943,10.5849073 17.3837484,10.9103415 17.8750917,11.3301378 L17.8750917,11.3301378 L18.1352423,11.1798935 C18.6782793,10.8666029 19.3472046,10.8668173 19.8900407,11.1804558 C20.4328768,11.4940943 20.7671539,12.0735079 20.766953,12.700437 C20.766752,13.3273661 20.4321037,13.9065653 19.8890667,14.2198558 L19.8890667,14.2198558 L19.6295007,14.3695155 C19.7463581,15.0053109 19.7463581,15.657081 19.6295007,16.2928763 L19.6295007,16.2928763 L19.8890667,16.442536 C20.7291137,16.9262566 21.0170255,17.9993824 20.5327203,18.8388448 C20.048415,19.6783072 18.9752893,19.966219 18.1358269,19.4819137 L18.1358269,19.4819137 L17.8745071,19.3310848 C17.3835251,19.751652 16.8190625,20.0778828 16.2095431,20.2933498 L16.2095431,20.2933498 L16.2095431,20.5932538 C16.2095431,21.5618643 15.4243291,22.3470783 14.4557186,22.3470783 C13.4871081,22.3470783 12.7018942,21.5618643 12.7018942,20.5932538 L12.7018942,20.5932538 L12.7018942,20.2933498 C12.0921365,20.0787187 11.5272791,19.7532816 11.035761,19.3334233 L11.035761,19.3334233 L10.7756104,19.4836676 C9.93614795,19.9679728 8.86302223,19.680061 8.37871698,18.8405986 C7.89441174,18.0011362 8.18232352,16.9280105 9.02178594,16.4437052 L9.02178594,16.4437052 L9.28135196,16.2940455 C9.16449456,15.6582502 9.16449456,15.0064801 9.28135196,14.3706847 L9.28135196,14.3706847 L9.02178594,14.2210251 C8.18232352,13.7367198 7.89441174,12.6635941 8.37871698,11.8241317 C8.86302223,10.9846693 9.93614795,10.6967575 10.7756104,11.1810627 L10.7756104,11.1810627 L11.0369302,11.3324762 C11.5279122,10.9119091 12.0923747,10.5856783 12.7018942,10.3702112 L12.7018942,10.3702112 L12.7018942,10.0703072 C12.7018942,9.10169676 13.4871081,8.31648282 14.4557186,8.31648282 Z M14.4557186,9.4856991 C14.1328485,9.4856991 13.8711105,9.74743708 13.8711105,10.0703072 L13.8711105,10.0703072 L13.8711105,10.8022366 C13.8723139,11.07002 13.6914222,11.3043843 13.4320698,11.3710604 C12.7120815,11.5569777 12.0565376,11.9359925 11.5361856,12.4672006 C11.3487348,12.6567008 11.0568363,12.6954122 10.8264713,12.5613225 L10.8264713,12.5613225 L10.1915868,12.1941886 C9.91181984,12.0327535 9.55415489,12.1286805 9.39271981,12.4084475 C9.23128473,12.6882145 9.3272117,13.0458795 9.60697869,13.2073145 L9.60697869,13.2073145 L10.2406939,13.5732792 C10.4706961,13.7060107 10.5823444,13.977088 10.5125367,14.2333018 C10.3145634,14.9506536 10.3145634,15.7082306 10.5125367,16.4255824 C10.5836371,16.6823877 10.4720844,16.9547784 10.2412785,17.0879434 L10.2412785,17.0879434 L9.6075633,17.4539081 C9.42519433,17.5575951 9.31236354,17.7510488 9.31190093,17.9608325 C9.31144116,18.1706163 9.42342029,18.3645641 9.60533161,18.469052 C9.78724292,18.5735399 10.0111941,18.5725466 10.1921714,18.4664494 L10.1921714,18.4664494 L10.8258867,18.0999001 C11.0569043,17.9660987 11.3492177,18.0057956 11.5361856,18.1963604 C12.0560944,18.7283304 12.7114511,19.1081624 13.4314852,19.2948391 C13.6899916,19.3613005 13.8706584,19.5944112 13.8705259,19.8613244 L13.8705259,19.8613244 L13.8705259,20.5932538 C13.8705259,20.916124 14.1322639,21.177862 14.455134,21.177862 C14.7780042,21.177862 15.0397422,20.916124 15.0397422,20.5932538 L15.0397422,20.5932538 L15.0397422,19.8607398 C15.0396097,19.5938266 15.2202765,19.3607159 15.4787829,19.2942545 C16.1987712,19.1083372 16.854315,18.7293224 17.3746671,18.1981143 C17.561635,18.0075494 17.8539484,17.9678526 18.084966,18.1016539 L18.084966,18.1016539 L18.7198504,18.4687878 C18.9996174,18.6302229 19.3572824,18.5342959 19.5187174,18.2545289 C19.6801525,17.9747619 19.5842256,17.617097 19.3044586,17.4556619 L19.3044586,17.4556619 L18.6707433,17.0896972 C18.4399375,16.9565322 18.3283848,16.6841415 18.3994852,16.4273362 C18.5974585,15.7099845 18.5974585,14.9524074 18.3994852,14.2350557 L18.3994852,14.2350557 L18.3815975,14.1392557 C18.3591014,13.9141058 18.469297,13.6920674 18.6701587,13.5756177 L18.6701587,13.5756177 L19.303874,13.209653 C19.4862429,13.105966 19.5990737,12.9125123 19.5995363,12.7027286 C19.5999961,12.4929448 19.488017,12.2989969 19.3061057,12.1945091 C19.1241943,12.0900212 18.9002432,12.0910144 18.7192658,12.1971117 L18.7192658,12.1971117 L18.0855506,12.563661 C17.854533,12.6974623 17.5622196,12.6577655 17.3752517,12.4672006 C16.8551812,11.9351393 16.1996112,11.5553008 15.4793675,11.3687219 C15.2208611,11.3022606 15.0401943,11.0691498 15.0403268,10.8022366 L15.0403268,10.8022366 L15.0403268,10.0703072 C15.0403268,9.74743708 14.7785888,9.4856991 14.4557186,9.4856991 Z M14.4557186,12.993348 C15.7471993,12.993348 16.7941512,14.0402999 16.7941512,15.3317805 C16.7941512,16.6232612 15.7471993,17.6702131 14.4557186,17.6702131 C13.164238,17.6702131 12.1172861,16.6232612 12.1172861,15.3317805 C12.1172861,14.0402999 13.164238,12.993348 14.4557186,12.993348 Z M8.00771468,0.366303609 C11.9592196,0.366303609 15.2195208,1.55445574 15.3690256,3.43109388 L15.3743814,3.56630361 L15.3742513,7.5289458 L15.1382629,7.51772823 L15.1382629,7.51772823 L14.9003938,7.51396385 L13.9748676,7.51405073 L13.9748676,7.51405073 L13.9746474,5.52059324 C12.632005,6.31164061 10.4521092,6.76630361 8.00771468,6.76630361 C5.56391184,6.76630361 3.38447974,6.31186071 2.04175713,5.52116765 L2.04104802,8.56630361 C2.04104802,9.37313171 4.68950641,10.3663036 8.00771468,10.3663036 L8.18736749,10.3646013 C7.85450051,10.7926203 7.56778192,11.2583059 7.33468295,11.7541869 C5.16605767,11.6790769 3.25865286,11.2382212 2.04053463,10.5204475 L2.04104802,13.5663036 C2.04104802,14.2582912 3.98922206,15.0873511 6.63722776,15.3093415 L6.63790195,15.7764557 C6.63790195,16.0963798 6.65827786,16.4115448 6.69780275,16.7207239 C3.35867177,16.4888021 0.779003475,15.3659521 0.646403803,13.7015133 L0.641048017,13.5663036 L0.641048017,3.56630361 L0.646403803,3.43109388 C0.795908613,1.55445574 4.05620975,0.366303609 8.00771468,0.366303609 Z M14.4557186,14.1625642 C13.8099783,14.1625642 13.2865023,14.6860402 13.2865023,15.3317805 C13.2865023,15.9775209 13.8099783,16.5009968 14.4557186,16.5009968 C15.101459,16.5009968 15.6249349,15.9775209 15.6249349,15.3317805 C15.6249349,14.6860402 15.101459,14.1625642 14.4557186,14.1625642 Z M8.00771468,1.76630361 C4.68950641,1.76630361 2.04104802,2.75947551 2.04104802,3.56630361 C2.04104802,4.37313171 4.68950641,5.36630361 8.00771468,5.36630361 C11.325923,5.36630361 13.9743814,4.37313171 13.9743814,3.56630361 C13.9743814,2.75947551 11.325923,1.76630361 8.00771468,1.76630361 Z"
                        id="Combined-Shape"
                        fill="rgba(0, 0, 0, 0.54)"
                        fillRule="nonzero"
                      ></path>
                      {/* </g> */}
                    </SVGIcon>
                  ),
                },
              ],
            }}
          />
        </ShellProvider>
      </Fragment>
    );
  }
}
App.propTypes = {
  ssoCallback: PropTypes.func,
  showToast: PropTypes.func,
  match: PropTypes.object,
  updateFilter: PropTypes.func,
  //location: PropTypes.string,
  history: PropTypes.object,
  filters: PropTypes.object,
  oauthClient: PropTypes.object,
  onFinishSSO: PropTypes.func,
};

export default App;
